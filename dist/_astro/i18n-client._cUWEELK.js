const S="modulepreload",j=function(t){return"/"+t},A={},L=function(e,n,u){let p=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),i=s?.nonce||s?.getAttribute("nonce");p=Promise.allSettled(n.map(c=>{if(c=j(c),c in A)return;A[c]=!0;const d=c.endsWith(".css"),o=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${o}`))return;const a=document.createElement("link");if(a.rel=d?"stylesheet":S,d||(a.as="script"),a.crossOrigin="",a.href=c,i&&a.setAttribute("nonce",i),document.head.appendChild(a),d)return new Promise((l,E)=>{a.addEventListener("load",l),a.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(s){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=s,window.dispatchEvent(i),!i.defaultPrevented)throw s}return p.then(s=>{for(const i of s||[])i.status==="rejected"&&r(i.reason);return e().catch(r)})};let h={},m=!1;function v(){return m}async function b(){if(m)return!0;if(typeof window<"u"&&window.TRANSLATIONS)return h=window.TRANSLATIONS,m=!0,!0;try{return h=(await L(()=>import("./translations.ILKHutgA.js"),[])).translations,m=!0,!0}catch(t){return console.error("Failed to load translations:",t),!1}}typeof window<"u"&&b().then(t=>{t?console.log("Translations loaded successfully"):console.warn("Failed to load translations")});const w="preferred-language";function y(){if(typeof window>"u")return"en";const e=new URLSearchParams(window.location.search).get("lang");if(e&&(e==="en"||e==="zh"))return localStorage.setItem(w,e),e;const n=localStorage.getItem(w);if(n&&(n==="en"||n==="zh"))return n;try{if(navigator.language.split("-")[0]==="zh")return"zh"}catch(u){console.error("Error detecting browser language:",u)}return"en"}function f(t,e){const n=e==="en"||e==="zh"?e:y();return m?h[t]?h[t][n]||h[t].en||t:(console.warn(`Translation key not found: ${t}`),t):(console.warn("Translations not loaded yet, using key as fallback"),t)}function g(){const t=y();setTimeout(()=>{document.documentElement.setAttribute("lang",t),document.documentElement.setAttribute("data-current-lang",t),document.querySelectorAll("[data-language]").forEach(e=>{e.getAttribute("data-language")===t?e.classList.remove("hidden"):e.classList.add("hidden")}),document.querySelectorAll("[data-i18n-key]").forEach(e=>{const n=e.getAttribute("data-i18n-key");n&&setTimeout(()=>{const u=f(n,t);e.textContent=u,e.setAttribute(`data-${t}-text`,u)},0)}),T(t)},100),document.querySelectorAll("[data-i18n-placeholder]").forEach(e=>{const n=e.getAttribute("data-i18n-placeholder");n&&e instanceof HTMLInputElement&&(e.placeholder=f(n,t))}),document.querySelectorAll("[data-i18n-alt]").forEach(e=>{const n=e.getAttribute("data-i18n-alt");n&&e instanceof HTMLImageElement&&(e.alt=f(n,t))}),document.querySelectorAll("[data-i18n-title]").forEach(e=>{const n=e.getAttribute("data-i18n-title");n&&e.setAttribute("title",f(n,t))}),document.querySelectorAll("[data-i18n-aria-label]").forEach(e=>{const n=e.getAttribute("data-i18n-aria-label");if(n)try{e.setAttribute("aria-label",f(n,t))}catch(u){console.error("翻译 aria-label 时出错:",u)}}),document.dispatchEvent(new CustomEvent("i18n:updated",{detail:{language:t}}))}function T(t){try{const e=window.location.pathname,n=window.location.origin,u=window.location.search,p=t==="en"?"":`?lang=${t}`;let r=typeof e=="string"?e:"/";(r.includes("[object Object]")||r.includes("object Object"))&&(console.warn("路径中包含对象引用，正在清理:",r),r=r.replace(/\/projects\/\[?object\s*Object\]?/gi,"/projects"),r=r.replace(/\/projects\/object\s*Object/gi,"/projects"));const s=r.match(/\/projects\/([^\/\?]+)/);if(s&&s[1]){const o=s[1];if((typeof o!="string"||o.includes("object")||o.includes("[object")||o.includes("undefined")||o==="null")&&(console.warn("检测到无效的项目 ID:",o),r="/projects",window.location.pathname.includes("/projects/"))){window.location.href=`${n}/projects`;return}}const i=document.querySelector('link[rel="canonical"]');i&&((r.includes("object")||r.includes("undefined")||r.includes("null"))&&(console.warn("规范链接中检测到无效路径:",r),r="/"),i.setAttribute("href",`${n}${r}${p}`)),document.querySelectorAll("link[hreflang]").forEach(o=>{const a=o.getAttribute("hreflang");let l=r;(l.includes("object")||l.includes("undefined")||l.includes("null"))&&(console.warn("语言链接中检测到无效路径:",l),l="/"),a==="en"?o.setAttribute("href",`${n}${l}`):a==="zh"?o.setAttribute("href",`${n}${l}?lang=zh`):a==="x-default"&&o.setAttribute("href",`${n}${l}`)});const c=document.querySelector("title"),d=document.querySelector('meta[name="description"]');if(c){const o=c.getAttribute("data-i18n-key");if(o)try{c.textContent=f(o,t)}catch(a){console.error("Error translating title:",a)}}if(d){const o=d.getAttribute("data-i18n-key");if(o)try{d.setAttribute("content",f(o,t))}catch(a){console.error("Error translating description:",a)}}}catch(e){console.error("更新元数据链接时出错:",e)}}function P(){return typeof window>"u"?Promise.resolve():new Promise(t=>{b().then(()=>{setTimeout(()=>{document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{g(),t()},100)}):(g(),t()),window.addEventListener("storage",e=>{e.key===w&&g()}),window.addEventListener("popstate",()=>{g()}),document.addEventListener("languageChanged",()=>g())},0)})})}const $=Object.freeze(Object.defineProperty({__proto__:null,getCurrentLanguage:y,initI18n:P,isTranslationsLoaded:v,loadTranslations:b,translateSync:f,updatePageContent:g},Symbol.toStringTag,{value:"Module"}));export{L as _,$ as a,y as g,P as i,f as t,g as u};
